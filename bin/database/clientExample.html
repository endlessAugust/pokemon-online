<html>
	<head>
		<title>Websocket client test</title>
	</head>
    <script src="http://code.jquery.com/jquery-latest.min.js"
            type="text/javascript"></script>
	<body>
		<p>
            <input type="text" id="url" value="ws://localhost:8508" onkeydown="if(event.keyCode==13) initWebsocket();"/>
			<button onClick="initWebsocket();">Connect</button>
			<button onClick="stopWebsocket();">Disconnect</button>
			<button onClick="checkSocket();">State</button>
		</p>
		<p>
			<textarea id="chatTextArea" style="width:400px;height:200px;"></textarea>
		</p>
        <p>
			<input type="text" id="inputText" onkeydown="if(event.keyCode==13)sendMessage();"/>
			<button onClick="sendMessage();">Envoyer</button>
		</p>
		
		<script type="text/javascript">
			var chatTextArea = document.getElementById("chatTextArea");
			function displayMessage(message)
			{
				chatTextArea.value += message + "\n";
				chatTextArea.scrollTop = chatTextArea.scrollHeight;
			}
			
			function sendMessage()
            {
                var strToSend = "msg|" + $("#inputText").val();
				if ( websocket != null )
				{
                    $("#inputText").val('');
					websocket.send( strToSend );
					console.log( "Message sent :", '"'+strToSend+'"' );
				}
			}
			
			var websocket = null;

			function initWebsocket()
			{
				try
				{
					if ( typeof MozWebSocket == 'function' )
						WebSocket = MozWebSocket;
					if ( websocket && websocket.readyState == 1 )
                        websocket.close();
                    displayMessage("Connecting to " + $("#url").val());
                    websocket = new WebSocket( $("#url").val() );
					websocket.onopen = function( evt ) {
						displayMessage( "CONNECTED" );
					};
					websocket.onclose = function( evt ) {
						displayMessage( "DISCONNECTED" );
					};
					websocket.onmessage = function( evt ) {
						console.log( "Message received :", evt.data );
						displayMessage( evt.data );
					};
					websocket.onerror = function( evt ) {
						displayMessage( 'ERROR: ' + evt.data );
					};
				}
				catch( exception )
				{
					displayMessage( 'ERROR: ' + exception );
				}
			}
			
			function stopWebsocket()
			{
				if ( websocket )
					websocket.close();
			}
			
			function checkSocket()
			{
				if ( websocket != null )
				{
					var stateStr;
					switch ( websocket.readyState )
					{
						case 0:
							stateStr = "CONNECTING";
							break;
						case 1:
							stateStr = "OPEN";
							break;
						case 2:
							stateStr = "CLOSING";
							break;
						case 3:
							stateStr = "CLOSED";
							break;
						default:
							stateStr = "UNKNOW";
							break;
					}
					displayMessage( "Websocket state = " + websocket.readyState + " ( " + stateStr + " )" );
				}
				else
				{
					displayMessage( "Websocket is null" );
				}
			}
			
		</script>
	</body>
</html>
